## Message Server
### What is a message server?
The job a message server is to accept new users registrations, receive and validate incomming messages and store them until they expire or the user fetches them.


### How do I register on a message server?
To register on a message server send a POST request to `/api/v1/user`.

The attribute values that must be set to successfully create a message are:

| Name | Type   | Description      | Required |
| ---- | ------ | ---------------- | -------- |
| key  | string | A public RSA key | true     |


The result will be returned as a JSON object containing the attributes:

| Name         | Type   | Description                                                |
| ------------ | ------ | ---------------------------------------------------------- |
| user_id      | string | A unique alphanumeric ID that can be used to send messages |

[Code example](./examples/MessageServerRegistration.md)



### How do I send a message?

To send a message to a message server send a POST request to `/api/v1/message`.

The attribute values that must be set to successfully create a message are:

| Name      | Type   | Description | Required |
| --------- | ------ | ----------- | -------- |
| data      | string | An encrypted packet object using the specified algorithm and password | true |
| algorithm | string | An encryption algorithm to decrypt the data attribute | true |
| password  | string | A random password to decrypt the data attribute encrypted with the message server's public key | true |


**Packet object**

| Name      | Type   | Description                                           | Required |
| --------- | ------ | ----------------------------------------------------- | -------- |
| id        | string | A unique ID generated by the client                   | true     |
| user_id   | string | A alphanumeric ID of the recieving user               | true     |
| token     | string | A valid access token for the specified user id        | true     |
| data      | string | Encrypted message object                              | true     |
| algorithm | string | An encryption algorithm to decrypt the data attribute | true     |
| password  | string | A random password to decrypt the data attribute encrypted with the user's public key | true |

**Message object**

| Name      | Type   | Description | Required |
| --------- | ------ | ----------- | -------- |
| from      | string | The username of the message sender | false |
| key       | string | The public key of the message sender |Â true |
| data_type | number | The message type identifier | true |
| data      | any    | The message data | true |
| date      | string | The creation date of the message | true |
| signature | string | The signature of the message object generated with the private key of the message sender | true |


A message will be created using the provided information. The response body will contain a JSON object containing the attributes:

| Name         | Type   | Description                                                |
| ------------ | ------ | ---------------------------------------------------------- |
| message_id   | string | A unique alphanumeric ID generated by the server           |



### How do I receive messages?

To retrive messages from a message server send a GET request to `/api/v1/message`.

The attribute values that must be set to successfully create a message are:

| Name       | Type   | Description | Required |
| ---------- | ------ | ----------- | -------- |
| user_id    | string | The user ID of the retriving user | true |
| date       | string | The creation date of the request | true |
| validity   | number | The maximum time in seconds until the request expires | true |
| signature  | string | The signature of the request object generated with the private key of the user | true |

The result will be returned as a JSON object containing the attributes:

| Name      | Type   | Description |
| --------- | ------ | ----------- |
| data      | string | An encrypted list of server message objects using the specified algorithm and password |
| algorithm | string | An encryption algorithm to decrypt the data attribute |
| password  | string | A random password to decrypt the data attribute encrypted with the user's public key |

**Server Message object**

| Name      | Type   | Description                                           |
| --------- | ------ | ----------------------------------------------------- |
| id        | string | The server message ID generated by the server         |
| token     | string | The used token to send the message                    |
| data      | string | Encrypted message object                              |
| algorithm | string | An encryption algorithm to decrypt the data attribute |
| password  | string | A random password to decrypt the data attribute encrypted with the user's public key |
| signature | string | The signature of the server message object generated with the private key of the message sender |


### How do I generate a access token?

To generate a new accees token from a message server send a POST request to `/api/v1/token`.

The attribute values that must be set to successfully create a access token are:

| Name      | Type   | Description | Required |
| --------- | ------ | ----------- | -------- |
| user_id    | string | The user ID of the retriving user | true |
| date       | string | The creation date of the request | true |
| validity   | number | The maximum time in seconds until the request expires | true |
| signature  | string | The signature of the request object generated with the private key of the user | true |

The result will be returned as a JSON object containing the attributes:

| Name      | Type   | Description |
| --------- | ------ | ----------- |
| token    | string | The generated access token |

### How do I revoke a access token?

### How do I revoke a user?

### How do I host a message server?

## Message

### Message Type Identifier

| Id  | Description |
| --- | ----------- |
| 1   | [Raw data]() |
| 2   | [Raw message]() |
| 3   | [Access token request]() |

#### Raw data


#### Raw message

```
last_id: string
name: string
content: string
```

